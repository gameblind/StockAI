
**StockAI 工作日志**

此文档记录 StockAI 项目开发和维护的详细工作内容，以便追踪项目进展和改动历史。

**日志目录**

**	**•**	**[2024-11-24](#2024-11-24)

**	**•**	**[2024-11-26](#2024-11-26)

**	**•**	**[2024-11-28](#2024-11-28)

**2024-11-24**

**主要任务**

**	**1.**	**修复 fetch_api_data** 函数中对 **api_key** 校验逻辑的冲突问题：**

**	**•**	**支持从 JSON 配置文件动态获取 **api_key**。

**	**•**	**优化参数校验逻辑，确保传参和默认值不冲突。

**	**2.**	**完善 test_main.py** 测试：**

**	**•**	**针对多个 API 添加详细测试用例：

**	**•**	**margin_trading_target_stocks

**	**•**	**margin_trading_historical_trends

**	**•**	**historical_intraday_trading

**	**•**	**historical_intraday_macd

**	**•**	**确保所有测试在逻辑更新后均通过。

**	**3.**	**重构 JSON 数据结构：

**	**•**	**将 **API Code** 修改为英文以便调用和维护。

**	**•**	**增加唯一主键字段 API Key Combined**，通过 **Category Code** 和 **API Code** 组合生成。**

**	**4.**	**更新 README.md**：**

**	**•**	**增加模块说明和安装使用指南。

**	**•**	**描述了必盈 API 数据接口信息。

**	**5.**	**修复 Git 同步冲突：

**	**•**	**采用本地代码为主的策略覆盖远端，完成同步。

**输出文件**

**	**•**	**更新后的 README.md

**	**•**	**新增的工作日志文件 **work_log.md**

**	**•**	**测试通过的完整代码

**问题记录**

**	**1.**	**fetch_api_data ** 参数校验冲突问题** **：**

**	**•**	** **解决** ：优先采用传参，其次获取默认配置。

**	**2.**	** **Git 同步冲突** ：

**	**•**	** **解决** **：使用 **git pull --rebase** 和 **git push** 更新远端代码。**

**2024-11-26**

**主要任务**

**	**1.**	**路径管理重构：

**	**•**	**创建 src/utils/path_manager.py** 工具模块，统一动态添加项目根目录到 **sys.path** 的逻辑。**

**	**•**	**替换脚本中的冗余路径代码，集中管理。

**	**2.**	**测试与调试：

**	**•**	**验证路径管理功能，包括：

**	**•**	**运行主脚本 **main.py**。

**	**•**	**独立运行模块（如 **fetch_data.py**）。

**	**•**	**修复 settings.json** 配置错误导致的 **FileNotFoundError**。**

**	**3.**	**提交代码：

**	**•**	** **提交信息** **：**更新路径管理系统并重构 main.py 和子模块

**	**•**	**使用 **git log** 确认提交记录，确保本地与远程仓库同步。

**2024-11-28**

**主要任务**

**	**1.**	**优化 ByApiManager** 模块：**

**	**•**	**增加对 fields_data_dictionary.json** 和 **api_fields_dictionary.json** 的解析功能。**

**	**•**	**确保 fetch_api_data** 和 **ByApiManager** 逻辑分离，各司其职。**

**	**•**	**增加 **get_fields_by_api_key** 方法，支持按 API 获取字段信息。

**	**2.**	**调整测试用例：

**	**•**	**修复 test_api_manager.py** 的路径问题。**

**	**•**	**测试覆盖：

**	**•**	**加载 API 数据字典和字段数据字典。

**	**•**	**使用 **fetch_api_data** 获取实际数据。

**	**•**	**验证 **get_fields_by_api_key** 方法是否能正确返回字段信息。

**	**3.**	**调试及解决问题：

**	**•**	**解决 KeyError: 'api_key'** 问题，确保 **settings.json** 中包含正确配置。**

**	**•**	**修复字段数据字典与 **fetch_api_data** 的兼容问题。

**	**4.**	**提交代码：

**	**•**	** **提交信息** **：**优化 ByApiManager 模块及测试用例

**	**•**	**更新工作日志和 README 文件。

**问题记录**

**	**1.**	** **测试用例路径导入失败** ：

**	**•**	** **解决** **：为 **test_api_manager.py** 添加动态路径管理。**

**	**2.**	** **API 参数替换冲突** ：

**	**•**	** **解决** ：调整 URL 模板解析逻辑，避免占位符缺失导致报错。

**	**3.**	** **数据字典兼容性问题** ：

**	**•**	** **解决** **：重新验证 **fields_data_dictionary.json** 和 **api_fields_dictionary.json** 的字段匹配逻辑。**

 **下一步计划** ：

**	**•**	**整合新的数据分析模块，支持字段数据的动态可视化。

**	**•**	**增加 API 接口调用性能测试。
